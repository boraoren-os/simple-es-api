"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require('aws-sdk');
const ddb = AWS.DynamoDB.DocumentClient();
const eventHandlers = require('./events');
const TableName = process.env.TABLE_NAME;
exports.processEvent = async (apiEvent) => {
    const handler = eventHandlers[apiEvent.type];
    if (!handler) {
        throw new Error(`Could not find an event handler for the event type ${apiEvent.type}`);
    }
    const getResult = await ddb.get({ TableName, Key: { eventId: apiEvent.eventId } }).promise();
    const model = getResult.Item || { eventId: apiEvent.eventId };
    const updatedModel = await handler(apiEvent, model);
    if (updatedModel) {
        await ddb.put({ TableName, Item: updatedModel }).promise();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQtYWdncmVnYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV2ZW50LWFnZ3JlZ2F0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0IsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUMxQyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFMUMsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7QUFDNUIsUUFBQSxZQUFZLEdBQUcsS0FBSyxFQUFFLFFBQWtCLEVBQUUsRUFBRTtJQUNyRCxNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdDLElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDVixNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztLQUMxRjtJQUNELE1BQU0sU0FBUyxHQUFHLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM3RixNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsSUFBSSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5RCxNQUFNLFlBQVksR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDcEQsSUFBSSxZQUFZLEVBQUU7UUFDZCxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDOUQ7QUFDTCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBV1MgPSByZXF1aXJlKCdhd3Mtc2RrJyk7XG5jb25zdCBkZGIgPSBBV1MuRHluYW1vREIuRG9jdW1lbnRDbGllbnQoKTtcbmNvbnN0IGV2ZW50SGFuZGxlcnMgPSByZXF1aXJlKCcuL2V2ZW50cycpO1xuXG5jb25zdCBUYWJsZU5hbWUgPSBwcm9jZXNzLmVudi5UQUJMRV9OQU1FO1xuZXhwb3J0IGNvbnN0IHByb2Nlc3NFdmVudCA9IGFzeW5jIChhcGlFdmVudDogQVBJRXZlbnQpID0+IHtcbiAgICBjb25zdCBoYW5kbGVyID0gZXZlbnRIYW5kbGVyc1thcGlFdmVudC50eXBlXTtcbiAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBhbiBldmVudCBoYW5kbGVyIGZvciB0aGUgZXZlbnQgdHlwZSAke2FwaUV2ZW50LnR5cGV9YCk7XG4gICAgfVxuICAgIGNvbnN0IGdldFJlc3VsdCA9IGF3YWl0IGRkYi5nZXQoeyBUYWJsZU5hbWUsIEtleTogeyBldmVudElkOiBhcGlFdmVudC5ldmVudElkIH0gfSkucHJvbWlzZSgpO1xuICAgIGNvbnN0IG1vZGVsID0gZ2V0UmVzdWx0Lkl0ZW0gfHwgeyBldmVudElkOiBhcGlFdmVudC5ldmVudElkIH07XG4gICAgY29uc3QgdXBkYXRlZE1vZGVsID0gYXdhaXQgaGFuZGxlcihhcGlFdmVudCwgbW9kZWwpO1xuICAgIGlmICh1cGRhdGVkTW9kZWwpIHtcbiAgICAgICAgYXdhaXQgZGRiLnB1dCh7IFRhYmxlTmFtZSwgSXRlbTogdXBkYXRlZE1vZGVsIH0pLnByb21pc2UoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQVBJRXZlbnQge1xuICAgIGV2ZW50SWQ6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xufSJdfQ==