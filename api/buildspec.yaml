version: '0.2'

phases:
  install:
    commands:
      - npm i -g aws-cdk@0.36.2
      - cdk --version
  build: 
    commands: 
      - env
      - cd api
      - npm i
      - cdk synth -c s3_deploy_bucket=$S3_LAMBDA_BUCKET
      - npm run build
      - zip -r lambda.zip . -i handlers/**/*.js
      - ls
artifacts: 
  secondary-artifacts:
    cfn_templates:
      files:
        - 'api/cdk.out/*'
    lambda_package:
      files:
        - 'api/lambda.zip'
      discard-paths: yes